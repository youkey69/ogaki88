<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤§å£æ–°å››å›½å…«åå…«ãƒ¶æ‰€éœŠå ´ ãƒãƒƒãƒ—ï¼†ãƒªã‚¹ãƒˆ</title>
<style>
    /* ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰ */
    body { font-family: "Helvetica Neue", Arial, sans-serif; background: #f4f7f6; margin: 0; padding: 20px; color: #333; }
    h1 { text-align: center; color: #2c3e50; font-size: 1.5em; margin-bottom: 20px; }
    
    /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ */
    .search-box { width: 100%; max-width: 600px; margin: 0 auto 20px; display: block; padding: 12px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }

    /* ã‚«ãƒ¼ãƒ‰å‹ãƒªã‚¹ãƒˆ */
    .card-container { max-width: 800px; margin: 0 auto; display: grid; gap: 15px; }
    .card { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 5px solid #009879; }
    
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .num { background: #009879; color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.9em; font-weight: bold; }
    .dist { font-size: 0.85em; color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; }
    
    .name { font-size: 1.2em; font-weight: bold; margin: 0; }
    .address { color: #555; margin-top: 5px; font-size: 0.95em; }
    
    /* Googleãƒãƒƒãƒ—ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
    .map-link { display: inline-block; margin-top: 10px; text-decoration: none; color: #009879; font-weight: bold; font-size: 0.9em; }
    .map-link:hover { text-decoration: underline; }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */
    #loading { text-align: center; margin-top: 50px; font-weight: bold; color: #666; }
</style>
</head>
<body>

<h1>å¤§å£æ–°å››å›½å…«åå…«ãƒ¶æ‰€éœŠå ´</h1>

<input type="text" id="searchInput" class="search-box" placeholder="å¯ºé™¢åã€ä½æ‰€ã€ç•ªå·ã§æ¤œç´¢..." onkeyup="filterData()">

<div id="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
<div id="listArea" class="card-container"></div>

<script>
    // â˜…é‡è¦â˜… ã“ã“ã«æ‰‹é †1ã§ã‚³ãƒ”ãƒ¼ã—ãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®CSV URLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR1qrxT318okqXIch_aqXFL-E4HfpiipLx2cqyfwH8FV4-lTQQn6_kG0QucHzA9eY-P8s9m0ioZ4qLj/pub?gid=0&single=true&output=csv";

    let allData = [];

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    window.onload = async function() {
        try {
            const response = await fetch(SHEET_CSV_URL);
            const text = await response.text();
            allData = parseCSV(text);
            document.getElementById("loading").style.display = "none";
            renderList(allData);
        } catch (error) {
            document.getElementById("loading").innerText = "ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚" + error;
        }
    };

    // CSVã‚’é…åˆ—ã«å¤‰æ›ã™ã‚‹ç°¡æ˜“é–¢æ•°
    function parseCSV(text) {
        // æ”¹è¡Œã§åˆ†å‰²ã—ã€ã‚«ãƒ³ãƒã§åˆ†å‰²ï¼ˆç°¡æ˜“çš„ãªå‡¦ç†ï¼‰
        const lines = text.trim().split('\n');
        const headers = lines[0].split(','); // 1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ä»®å®š
        
        const result = [];
        for (let i = 1; i < lines.length; i++) {
            // ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆç­‰ã®å‡¦ç†ãŒå¿…è¦ãªå ´åˆã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¨å¥¨ã ãŒã€ä»Šå›ã¯ç°¡æ˜“å®Ÿè£…
            const currentLine = lines[i].split(',');
            if(currentLine.length < 2) continue; // ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—

            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—é †ã«åˆã‚ã›ã¦èª¿æ•´ã—ã¦ãã ã•ã„
            // ä¾‹ï¼š0:æœ­ç•ªå·, 1:å¯ºé™¢å, 2:ä½æ‰€, 3:è·é›¢
            result.push({
                num: currentLine[0].replace(/"/g, "").trim(),
                name: currentLine[1].replace(/"/g, "").trim(),
                address: currentLine[2].replace(/"/g, "").trim(),
                distance: currentLine[3] ? currentLine[3].replace(/"/g, "").trim() : "-"
            });
        }
        return result;
    }

    // ãƒªã‚¹ãƒˆã‚’æç”»ã™ã‚‹é–¢æ•°
    function renderList(data) {
        const container = document.getElementById("listArea");
        container.innerHTML = "";

        if (data.length === 0) {
            container.innerHTML = "<p style='text-align:center'>è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>";
            return;
        }

        data.forEach(item => {
            const div = document.createElement("div");
            div.className = "card";
            // ä½æ‰€ã‹ã‚‰Googleãƒãƒƒãƒ—ã®æ¤œç´¢URLã‚’ç”Ÿæˆ
            const mapUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.address + " " + item.name)}`;
            
            div.innerHTML = `
                <div class="card-header">
                    <span class="num">${item.num}</span>
                    <span class="dist">ç¶¾é‡ã‹ã‚‰ ${item.distance}km</span>
                </div>
                <h2 class="name">${item.name}</h2>
                <div class="address">${item.address}</div>
                <a href="${mapUrl}" target="_blank" class="map-link">ğŸ“ Googleãƒãƒƒãƒ—ã§è¦‹ã‚‹</a>
            `;
            container.appendChild(div);
        });
    }

    // æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°
    function filterData() {
        const keyword = document.getElementById("searchInput").value.toLowerCase();
        const filtered = allData.filter(item => 
            item.name.toLowerCase().includes(keyword) || 
            item.address.toLowerCase().includes(keyword) || 
            item.num.toLowerCase().includes(keyword)
        );
        renderList(filtered);
    }
</script>

</body>
</html>
